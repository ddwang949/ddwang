---
description: 之前写的，从微步搬回到新的page上先
---

# Cacti CVE-2022-46169 远程命令执行漏洞分析

#### 漏洞编号

CVE-2022-46169

#### 影响范围

| 漏洞编号           | 影响厂商                | 产品    |
| -------------- | ------------------- | ----- |
| CVE-2022-46169 | The Cacti Group Inc | Cacti |



漏洞分析

### **CVE-2022-46169**

CVE-2022-46169漏洞利用包含两部分

1.身份认证绕过

2.远程命令执行

#### **漏洞分析**

1. **身份认证绕过分析**

由CVE描述可知，产生漏洞的文件为remote\_agent.php，

默认直接访问会显示报错信息FATAL: You are not authorized to use this service

查找到报错信息提示的代码处：

```
if (!remote_client_authorized()) {
    print 'FATAL: You are not authorized to use this service';
    exit;
}
```

因此身份认证绕过实际上则是需要绕过函数remote\_client\_authorized()的判断，函数remote\_client\_authorized()的实现如下：

<figure><img src="https://img.threatbook.com/b96624800e81a44be7910c516a2eddc6299e1254c00548c55c7adaa31ad11857.png" alt=""><figcaption></figcaption></figure>

remote\_client\_authorized()函数首先调用get\_client\_addr()函数，此函数在lib/functions.php中调用

<figure><img src="https://img.threatbook.com/d58e1c4452dcc7029ec2386950f5a05f981d3b1476df6e3e90db32f5c533aa15.png" alt=""><figcaption></figcaption></figure>

因此需要在HTTP请求头中添加源码中之一的header条目，并将其值设置为合法的白名单IP地址即可通过身份认证，IP地址可以通过暴力破解获取。

2. **命令执行分析**

由补丁差异可知remote\_agent.php主要将$poller\_id和$networkid进行了过滤和转义。





```
code demo
```
