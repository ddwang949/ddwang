---
description: 之前写的，从微步搬回到新的page上先
---

# OpenSSL CVE-2022-3602 缓冲区溢出分析

### 漏洞编号

CVE-2022-3602

## #影响范围

| 漏洞编号          | 影响厂商           | 产品                   |
| ------------- | -------------- | -------------------- |
| CVE-2022-3602 | Joyent         | Node.js              |
|               | OpenSSL        | Openssl              |
|               | NetApp         | Clustered Data Ontap |
|               | Fedora Project | Fedora               |
|               | Oracle         | Essbase              |

漏洞描述栈溢出漏洞分析

### 漏洞编号

CVE-2022-3602

### 影响产品

OpenSSL 3.0.x

X.509 certificate verification功能

### 漏洞描述

攻击者可以通过编造以“xn--”开头的一个恶意电子邮件地址来利用此漏洞，成功的漏洞利用可能导致栈溢出，但是只能溢出四个字节，不太可能导致代码执行。

### 漏洞定位

crypto/punycode.c中定义了ossl_a2ulabel()函数

ossl_a2ulabel()函数调用了ossl_punycode_decode()来对以“xn--”开头的punycode进行解码

ossl_punycode_decode()在解码时边界处理不当，导致缓冲区溢出

### POC

"xn--"加上长度大于等于512的任意字符

### 漏洞分析

#### 原理分析：

Name Constraints扩展处理字符串时调用了函数ossl_a2ulabel()，ossl_a2ulabel()调用ossl_punycode_decode()来对以“xn--”开头的punycode进行解码。ossl_punycode_decode()定义了固定大小为512的整数数组来保存所有已解码的Unicode字符。然而该函数在进行punycode时未能正确处理边界条件(即＞和≥)。如果解码字符的长度大于等于512，攻击者可以越界写入该数组中的第513项，并使基于堆栈的缓冲区最多溢出4个字节(一个int)。

#### 源码分析：

 crypto/punycode.c:
 
 ![image](https://github.com/user-attachments/assets/b749ec57-1a66-4925-8176-56ed88ae1db9)

![image](https://github.com/user-attachments/assets/0f5cd011-5266-437c-ad1a-a1e113486238)


#### 参考链接

https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3602
